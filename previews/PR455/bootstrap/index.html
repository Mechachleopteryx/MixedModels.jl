<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parametric bootstrap for mixed-effects models · MixedModels</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="MixedModels logo"/></a><div class="docs-package-name"><span class="docs-autofit">MixedModels</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">MixedModels.jl Documentation</a></li><li><a class="tocitem" href="../constructors/">Model constructors</a></li><li><a class="tocitem" href="../optimization/">Details of the parameter estimation</a></li><li><a class="tocitem" href="../GaussHermite/">Normalized Gauss-Hermite Quadrature</a></li><li class="is-active"><a class="tocitem" href>Parametric bootstrap for mixed-effects models</a><ul class="internal"><li><a class="tocitem" href="#The-parametric-bootstrap"><span>The parametric bootstrap</span></a></li></ul></li><li><a class="tocitem" href="../rankdeficiency/">Rank deficiency in mixed-effects models</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Parametric bootstrap for mixed-effects models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parametric bootstrap for mixed-effects models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaStats/MixedModels.jl/blob/master/docs/src/bootstrap.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Parametric-bootstrap-for-mixed-effects-models"><a class="docs-heading-anchor" href="#Parametric-bootstrap-for-mixed-effects-models">Parametric bootstrap for mixed-effects models</a><a id="Parametric-bootstrap-for-mixed-effects-models-1"></a><a class="docs-heading-anchor-permalink" href="#Parametric-bootstrap-for-mixed-effects-models" title="Permalink"></a></h1><p>Julia is well-suited to implementing bootstrapping and other simulation-based methods for statistical models. The <code>parametricbootstrap</code> function in the <a href="https://github.com/JuliaStats/MixedModels.jl">MixedModels package</a> provides an efficient parametric bootstrap for mixed-effects models.</p><article class="docstring"><header><a class="docstring-binding" id="MixedModels.parametricbootstrap" href="#MixedModels.parametricbootstrap"><code>MixedModels.parametricbootstrap</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">parametricbootstrap(rng::AbstractRNG, nsamp::Integer, m::MixedModel;
    β = coef(m), σ = m.σ, θ = m.θ, use_threads=false)
parametricbootstrap(nsamp::Integer, m::MixedModel;
    β = coef(m), σ = m.σ, θ = m.θ, use_threads=false)</code></pre><p>Perform <code>nsamp</code> parametric bootstrap replication fits of <code>m</code>, returning a <code>MixedModelBootstrap</code>.</p><p>The default random number generator is <code>Random.GLOBAL_RNG</code>.</p><p><strong>Named Arguments</strong></p><p><code>β</code>, <code>σ</code>, and <code>θ</code> are the values of <code>m</code>&#39;s parameters for simulating the responses. <code>σ</code> is only valid for <code>LinearMixedModel</code> and <code>GeneralizedLinearMixedModel</code> for families with a dispersion parameter. <code>use_threads</code> determines whether or not to use thread-based parallelism.</p><p>Note that <code>use_threads=true</code> may not offer a performance boost and may even decrease peformance if multithreaded linear algebra (BLAS) routines are available. In this case, threads at the level of the linear algebra may already occupy all processors/processor cores. There are plans to provide better support in coordinating Julia- and BLAS-level threads in the future.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/7418ac63144ecb33776e08579bae93ba5f5bdc6c/src/bootstrap.jl#L34-L56">source</a></section></article><h2 id="The-parametric-bootstrap"><a class="docs-heading-anchor" href="#The-parametric-bootstrap">The parametric bootstrap</a><a id="The-parametric-bootstrap-1"></a><a class="docs-heading-anchor-permalink" href="#The-parametric-bootstrap" title="Permalink"></a></h2><p><a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">Bootstrapping</a> is a family of procedures for generating sample values of a statistic, allowing for visualization of the distribution of the statistic or for inference from this sample of values.</p><p>A <em>parametric bootstrap</em> is used with a parametric model, <code>m</code>, that has been fit to data. The procedure is to simulate <code>n</code> response vectors from <code>m</code> using the estimated parameter values and refit <code>m</code> to these responses in turn, accumulating the statistics of interest at each iteration.</p><p>The parameters of a <code>LinearMixedModel</code> object are the fixed-effects parameters, <code>β</code>, the standard deviation, <code>σ</code>, of the per-observation noise, and the covariance parameter, <code>θ</code>, that defines the variance-covariance matrices of the random effects.</p><p>For example, a simple linear mixed-effects model for the <code>Dyestuff</code> data in the <a href="http://github.com/lme4/lme4"><code>lme4</code></a> package for <a href="https://www.r-project.org"><code>R</code></a> is fit by</p><pre><code class="language-julia">using DataFrames
using DataFramesMeta  # dplyr-like operations
using Gadfly          # plotting package
using MixedModels
using Random</code></pre><pre><code class="language-">dyestuff = MixedModels.dataset(:dyestuff)
m1 = fit(MixedModel, @formula(yield ~ 1 + (1 | batch)), dyestuff)</code></pre><p>To bootstrap the model parameters, first initialize a random number generator then create a bootstrap sample</p><pre><code class="language-">const rng = MersenneTwister(1234321);
samp = parametricbootstrap(rng, 10_000, m1, use_threads=true);
df = DataFrame(samp.allpars);
first(df, 10)</code></pre><p>Especially for those with a background in <a href="https://www.R-project.org/"><code>R</code></a> or <a href="https://pandas.pydata.org"><code>pandas</code></a>, the simplest way of accessing the parameter estimates in the parametric bootstrap object is to create a <code>DataFrame</code> from the <code>allpars</code> property as shown above.</p><p>The <a href="https://github.com/JuliaData/DataFramesMeta.jl"><code>DataFramesMeta</code></a> package provides macros for extracting rows or columns of a dataframe. A density plot of the estimates of <code>σ</code>, the residual standard deviation, can be created as</p><pre><code class="language-">σres = @where(df, :type .== &quot;σ&quot;, :group .== &quot;residual&quot;).value
plot(x = σres, Geom.density, Guide.xlabel(&quot;Parametric bootstrap estimates of σ&quot;))</code></pre><p>For the estimates of the intercept parameter, the <code>getproperty</code> extractor must be used</p><pre><code class="language-">plot(@where(df, :type .== &quot;β&quot;), x = :value, Geom.density, Guide.xlabel(&quot;Parametric bootstrap estimates of β₁&quot;))</code></pre><p>A density plot of the estimates of the standard deviation of the random effects is obtained as</p><pre><code class="language-">σbatch = @where(df, :type .== &quot;σ&quot;, :group .== &quot;batch&quot;).value
plot(x = σbatch, Geom.density,
    Guide.xlabel(&quot;Parametric bootstrap estimates of σ₁&quot;))</code></pre><p>Notice that this density plot has a spike, or mode, at zero. Although this mode appears to be diffuse, this is an artifact of the way that density plots are created. In fact, it is a pulse, as can be seen from a histogram.</p><pre><code class="language-">plot(x = σbatch, Geom.histogram,
    Guide.xlabel(&quot;Parametric bootstrap estimates of σ₁&quot;))</code></pre><p>The bootstrap sample can be used to generate intervals that cover a certain percentage of the bootstrapped values. We refer to these as &quot;coverage intervals&quot;, similar to a confidence interval. The shortest such intervals, obtained with the <code>shortestcovint</code> extractor, correspond to a highest posterior density interval in Bayesian inference.</p><article class="docstring"><header><a class="docstring-binding" id="MixedModels.shortestcovint" href="#MixedModels.shortestcovint"><code>MixedModels.shortestcovint</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">shortestcovint(v, level = 0.95)</code></pre><p>Return the shortest interval containing <code>level</code> proportion of the values of <code>v</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/7418ac63144ecb33776e08579bae93ba5f5bdc6c/src/bootstrap.jl#L228-L232">source</a></section></article><p>We generate these for all random and fixed effects:</p><pre><code class="language-">combine(groupby(df, [:type, :group, :names]), :value =&gt; shortestcovint =&gt; :interval)</code></pre><p>A value of zero for the standard deviation of the random effects is an example of a <em>singular</em> covariance. It is easy to detect the singularity in the case of a scalar random-effects term. However, it is not as straightforward to detect singularity in vector-valued random-effects terms.</p><p>For example, if we bootstrap a model fit to the <code>sleepstudy</code> data</p><pre><code class="language-">sleepstudy = MixedModels.dataset(:sleepstudy)
m2 = fit(
    MixedModel,
    @formula(reaction ~ 1+days+(1+days|subj)),
    sleepstudy,
)</code></pre><pre><code class="language-">samp2 = parametricbootstrap(rng, 10_000, m2, use_threads=true);
df2 = DataFrame(samp2.allpars);
first(df2, 10)</code></pre><p>the singularity can be exhibited as a standard deviation of zero or as a correlation of <span>$\pm1$</span>.</p><pre><code class="language-">combine(groupby(df2, [:type, :group, :names]), :value =&gt; shortestcovint =&gt; :interval)</code></pre><p>A histogram of the estimated correlations from the bootstrap sample has a spike at <code>+1</code>.</p><pre><code class="language-">ρs = @where(df2, :type .== &quot;ρ&quot;, :group .== &quot;subj&quot;).value
plot(x = ρs, Geom.histogram,
    Guide.xlabel(&quot;Parametric bootstrap samples of correlation of random effects&quot;))</code></pre><p>or, as a count,</p><pre><code class="language-">sum(ρs .≈ 1)</code></pre><p>Close examination of the histogram shows a few values of <code>-1</code>.</p><pre><code class="language-">sum(ρs .≈ -1)</code></pre><p>Furthermore there are even a few cases where the estimate of the standard deviation of the random effect for the intercept is zero.</p><pre><code class="language-">σs = @where(df2, :type .== &quot;σ&quot;, :group .== &quot;subj&quot;, :names .== &quot;(Intercept)&quot;).value
sum(σs .≈ 0)</code></pre><p>There is a general condition to check for singularity of an estimated covariance matrix or matrices in a bootstrap sample. The parameter optimized in the estimation is <code>θ</code>, the relative covariance parameter. Some of the elements of this parameter vector must be non-negative and, when one of these components is approximately zero, one of the covariance matrices will be singular.</p><p>The <code>issingular</code> method for a <code>MixedModel</code> object that tests if a parameter vector <code>θ</code> corresponds to a boundary or singular fit.</p><p>This operation is encapsulated in a method for the <code>issingular</code> function.</p><pre><code class="language-">sum(issingular(samp2))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../GaussHermite/">« Normalized Gauss-Hermite Quadrature</a><a class="docs-footer-nextpage" href="../rankdeficiency/">Rank deficiency in mixed-effects models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 13 January 2021 10:06">Wednesday 13 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
